<!DOCTYPE html>
<html lang="zh-CN">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='推荐看👉常用设计模式有哪些？ (refactoringguru.cn)
代理模式 解释
对真正要被访问的产品或类加以控制，并可以进行一些控制，把访问产品与代理进行映射，访问代理就相当于访问产品
适用场景：
使用代理模式的方式多种多样， 我们来看看最常见的几种。
延迟初始化 （虚拟代理）。 如果你有一个偶尔使用的重量级服务对象， 一直保持该对象运行会消耗系统资源时， 可使用代理模式。
你无需在程序启动时就创建该对象， 可将对象的初始化延迟到真正有需要的时候。
访问控制 （保护代理）。 如果你只希望特定客户端使用服务对象， 这里的对象可以是操作系统中非常重要的部分， 而客户端则是各种已启动的程序 （包括恶意程序）， 此时可使用代理模式。
代理可仅在客户端凭据满足要求时将请求传递给服务对象。
本地执行远程服务 （远程代理）。 适用于服务对象位于远程服务器上的情形。
在这种情形中， 代理通过网络传递客户端请求， 负责处理所有与网络相关的复杂细节。
记录日志请求 （日志记录代理）。 适用于当你需要保存对于服务对象的请求历史记录时。 代理可以在向服务传递请求前进行记录。
缓存请求结果 （缓存代理）。 适用于需要缓存客户请求结果并对缓存生命周期进行管理时， 特别是当返回结果的体积非常大时。
代理可对重复请求所需的相同结果进行缓存， 还可使用请求参数作为索引缓存的键值。
智能引用。 可在没有客户端使用某个重量级对象时立即销毁该对象。
代理会将所有获取了指向服务对象或其结果的客户端记录在案。 代理会时不时地遍历各个客户端， 检查它们是否仍在运行。 如果相应的客户端列表为空， 代理就会销毁该服务对象， 释放底层系统资源。
代理还可以记录客户端是否修改了服务对象。 其他客户端还可以复用未修改的对象。
class Subject { public: virtual void Request() const = 0; }; /** * The RealSubject contains some core business logic. Usually, RealSubjects are * capable of doing some useful work which may also be very slow or sensitive - * e.'><title>C&#43;&#43;设计模式-结构型模式</title>

<link rel='canonical' href='https://okokfun.github.io/post/c-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='C&#43;&#43;设计模式-结构型模式'>
<meta property='og:description' content='推荐看👉常用设计模式有哪些？ (refactoringguru.cn)
代理模式 解释
对真正要被访问的产品或类加以控制，并可以进行一些控制，把访问产品与代理进行映射，访问代理就相当于访问产品
适用场景：
使用代理模式的方式多种多样， 我们来看看最常见的几种。
延迟初始化 （虚拟代理）。 如果你有一个偶尔使用的重量级服务对象， 一直保持该对象运行会消耗系统资源时， 可使用代理模式。
你无需在程序启动时就创建该对象， 可将对象的初始化延迟到真正有需要的时候。
访问控制 （保护代理）。 如果你只希望特定客户端使用服务对象， 这里的对象可以是操作系统中非常重要的部分， 而客户端则是各种已启动的程序 （包括恶意程序）， 此时可使用代理模式。
代理可仅在客户端凭据满足要求时将请求传递给服务对象。
本地执行远程服务 （远程代理）。 适用于服务对象位于远程服务器上的情形。
在这种情形中， 代理通过网络传递客户端请求， 负责处理所有与网络相关的复杂细节。
记录日志请求 （日志记录代理）。 适用于当你需要保存对于服务对象的请求历史记录时。 代理可以在向服务传递请求前进行记录。
缓存请求结果 （缓存代理）。 适用于需要缓存客户请求结果并对缓存生命周期进行管理时， 特别是当返回结果的体积非常大时。
代理可对重复请求所需的相同结果进行缓存， 还可使用请求参数作为索引缓存的键值。
智能引用。 可在没有客户端使用某个重量级对象时立即销毁该对象。
代理会将所有获取了指向服务对象或其结果的客户端记录在案。 代理会时不时地遍历各个客户端， 检查它们是否仍在运行。 如果相应的客户端列表为空， 代理就会销毁该服务对象， 释放底层系统资源。
代理还可以记录客户端是否修改了服务对象。 其他客户端还可以复用未修改的对象。
class Subject { public: virtual void Request() const = 0; }; /** * The RealSubject contains some core business logic. Usually, RealSubjects are * capable of doing some useful work which may also be very slow or sensitive - * e.'>
<meta property='og:url' content='https://okokfun.github.io/post/c-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/'>
<meta property='og:site_name' content='My Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='设计模式' /><meta property='article:published_time' content='2022-01-03T15:07:58&#43;00:00'/><meta property='article:modified_time' content='2022-01-03T15:07:58&#43;00:00'/>
<meta name="twitter:title" content="C&#43;&#43;设计模式-结构型模式">
<meta name="twitter:description" content="推荐看👉常用设计模式有哪些？ (refactoringguru.cn)
代理模式 解释
对真正要被访问的产品或类加以控制，并可以进行一些控制，把访问产品与代理进行映射，访问代理就相当于访问产品
适用场景：
使用代理模式的方式多种多样， 我们来看看最常见的几种。
延迟初始化 （虚拟代理）。 如果你有一个偶尔使用的重量级服务对象， 一直保持该对象运行会消耗系统资源时， 可使用代理模式。
你无需在程序启动时就创建该对象， 可将对象的初始化延迟到真正有需要的时候。
访问控制 （保护代理）。 如果你只希望特定客户端使用服务对象， 这里的对象可以是操作系统中非常重要的部分， 而客户端则是各种已启动的程序 （包括恶意程序）， 此时可使用代理模式。
代理可仅在客户端凭据满足要求时将请求传递给服务对象。
本地执行远程服务 （远程代理）。 适用于服务对象位于远程服务器上的情形。
在这种情形中， 代理通过网络传递客户端请求， 负责处理所有与网络相关的复杂细节。
记录日志请求 （日志记录代理）。 适用于当你需要保存对于服务对象的请求历史记录时。 代理可以在向服务传递请求前进行记录。
缓存请求结果 （缓存代理）。 适用于需要缓存客户请求结果并对缓存生命周期进行管理时， 特别是当返回结果的体积非常大时。
代理可对重复请求所需的相同结果进行缓存， 还可使用请求参数作为索引缓存的键值。
智能引用。 可在没有客户端使用某个重量级对象时立即销毁该对象。
代理会将所有获取了指向服务对象或其结果的客户端记录在案。 代理会时不时地遍历各个客户端， 检查它们是否仍在运行。 如果相应的客户端列表为空， 代理就会销毁该服务对象， 释放底层系统资源。
代理还可以记录客户端是否修改了服务对象。 其他客户端还可以复用未修改的对象。
class Subject { public: virtual void Request() const = 0; }; /** * The RealSubject contains some core business logic. Usually, RealSubjects are * capable of doing some useful work which may also be very slow or sensitive - * e."><script>
    (function(){
        if(''){
            if (prompt('请输入文章密码') !== ''){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>


    </head>
    <body class="
    article-page 
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        on-phone--column extended
    
">
    
        <aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header class="site-info">
        
            
            <figure class="site-avatar">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu71fc3898bde3464d50a00f65e63c7ec2_517570_300x0_resize_box_3.png" width="300"
                            height="354" class="site-logo" loading="lazy" alt="Avatar">
                    
                

                
            </figure>
            
        
        
        <h1 class="site-name"><a href="/">My Blog</a></h1>
        <h2 class="site-description"></h2></header>

    <ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/page/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        

        <li >
            <a href='/page/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/page/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        
            <li id="dark-mode-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <span>Dark Mode</span>
            </li>
        
    </ol>
</aside>

    
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <h2 class="article-title">
        <a href="/post/c-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/">C&#43;&#43;设计模式-结构型模式</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 03, 2022</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    16 minute read
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <!-- raw HTML omitted -->
<p>推荐看👉<a class="link" href="https://refactoringguru.cn/design-patterns"  target="_blank" rel="noopener"
    >常用设计模式有哪些？ (refactoringguru.cn)</a></p>
<h1 id="代理模式">代理模式</h1>
<p>解释</p>
<blockquote>
<p>对真正要被访问的产品或类加以控制，并可以进行一些控制，把访问产品与代理进行映射，访问代理就相当于访问产品</p>
</blockquote>
<p>适用场景：</p>
<p>使用代理模式的方式多种多样， 我们来看看最常见的几种。</p>
<ul>
<li>
<p><strong>延迟初始化 （虚拟代理）。 如果你有一个偶尔使用的重量级服务对象， 一直保持该对象运行会消耗系统资源时， 可使用代理模式。</strong></p>
</li>
<li>
<p>你无需在程序启动时就创建该对象， 可将对象的初始化延迟到真正有需要的时候。</p>
</li>
<li>
<p><strong>访问控制 （保护代理）。 如果你只希望特定客户端使用服务对象， 这里的对象可以是操作系统中非常重要的部分， 而客户端则是各种已启动的程序 （包括恶意程序）， 此时可使用代理模式。</strong></p>
</li>
<li>
<p>代理可仅在客户端凭据满足要求时将请求传递给服务对象。</p>
</li>
<li>
<p><strong>本地执行远程服务 （远程代理）。 适用于服务对象位于远程服务器上的情形。</strong></p>
</li>
<li>
<p>在这种情形中， 代理通过网络传递客户端请求， 负责处理所有与网络相关的复杂细节。</p>
</li>
<li>
<p><strong>记录日志请求 （日志记录代理）。 适用于当你需要保存对于服务对象的请求历史记录时。 代理可以在向服务传递请求前进行记录。</strong></p>
</li>
<li>
<p>缓存请求结果 （缓存代理）。 适用于需要缓存客户请求结果并对缓存生命周期进行管理时， 特别是当返回结果的体积非常大时。</p>
</li>
<li>
<p>代理可对重复请求所需的相同结果进行缓存， 还可使用请求参数作为索引缓存的键值。</p>
</li>
<li>
<p><strong>智能引用。 可在没有客户端使用某个重量级对象时立即销毁该对象。</strong></p>
</li>
<li>
<p>代理会将所有获取了指向服务对象或其结果的客户端记录在案。 代理会时不时地遍历各个客户端， 检查它们是否仍在运行。 如果相应的客户端列表为空， 代理就会销毁该服务对象， 释放底层系统资源。</p>
</li>
<li>
<p>代理还可以记录客户端是否修改了服务对象。 其他客户端还可以复用未修改的对象。</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Subject</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  	<span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> Request() <span style="color:#66d9ef">const</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The RealSubject contains some core business logic. Usually, RealSubjects are
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * capable of doing some useful work which may also be very slow or sensitive -
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * e.g. correcting input data. A Proxy can solve these issues without any
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * changes to the RealSubject&#39;s code.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RealSubject</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Subject {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  	<span style="color:#66d9ef">void</span> Request() <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;RealSubject: Handling request.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  	}
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The Proxy has an interface identical to the RealSubject.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Proxy</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Subject {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @var RealSubject
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  	RealSubject <span style="color:#f92672">*</span>real_subject_;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">CheckAccess</span>() <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Some real checks should go here.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Proxy: Checking access prior to firing a real request.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> true;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">LogAccess</span>() <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Proxy: Logging the time of request.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * The Proxy maintains a reference to an object of the RealSubject class. It
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * can be either lazy-loaded or passed to the Proxy by the client.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    Proxy(RealSubject <span style="color:#f92672">*</span>real_subject) <span style="color:#f92672">:</span> real_subject_(<span style="color:#66d9ef">new</span> RealSubject(<span style="color:#f92672">*</span>real_subject)) {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">~</span>Proxy() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">delete</span> real_subject_;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * The most common applications of the Proxy pattern are lazy loading,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * caching, controlling the access, logging, etc. A Proxy can perform one of
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * these things and then, depending on the result, pass the execution to the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * same method in a linked RealSubject object.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Request</span>() <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>CheckAccess()) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>real_subject_<span style="color:#f92672">-&gt;</span>Request();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>LogAccess();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The client code is supposed to work with all objects (both subjects and
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * proxies) via the Subject interface in order to support both real subjects and
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * proxies. In real life, however, clients mostly work with their real subjects
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * directly. In this case, to implement the pattern more easily, you can extend
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * your proxy from the real subject&#39;s class.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ClientCode</span>(<span style="color:#66d9ef">const</span> Subject <span style="color:#f92672">&amp;</span>subject) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    subject.Request();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Client: Executing the client code with a real subject:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    RealSubject <span style="color:#f92672">*</span>real_subject <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RealSubject;
</span></span><span style="display:flex;"><span>    ClientCode(<span style="color:#f92672">*</span>real_subject);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Client: Executing the same client code with a proxy:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    Proxy <span style="color:#f92672">*</span>proxy <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Proxy(real_subject);
</span></span><span style="display:flex;"><span>    ClientCode(<span style="color:#f92672">*</span>proxy);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> real_subject;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> proxy;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="适配器模式">适配器模式</h1>
<p><strong>适配器模式</strong>是一种结构型设计模式， 它能使接口不兼容的对象能够相互合作。</p>
<p>适用场景：</p>
<ul>
<li>
<p><strong>当你希望使用某个类， 但是其接口与其他代码不兼容时， 可以使用适配器类。</strong></p>
</li>
<li>
<p>适配器模式允许你创建一个中间层类， 其可作为代码与遗留类、 第三方类或提供怪异接口的类之间的转换器。</p>
</li>
<li>
<p><strong>如果您需要复用这样一些类， 他们处于同一个继承体系， 并且他们又有了额外的一些共同的方法， 但是这些共同的方法不是所有在这一继承体系中的子类所具有的共性。</strong></p>
</li>
<li>
<p>你可以扩展每个子类， 将缺少的功能添加到新的子类中。 但是， 你必须在所有新子类中重复添加这些代码， 这样会使得代码有<a class="link" href="https://refactoringguru.cn/smells/duplicate-code"  target="_blank" rel="noopener"
    >坏味道</a>。</p>
</li>
<li>
<p>将缺失功能添加到一个适配器类中是一种优雅得多的解决方案。 然后你可以将缺少功能的对象封装在适配器中， 从而动态地获取所需功能。 如要这一点正常运作， 目标类必须要有通用接口， 适配器的成员变量应当遵循该通用接口。 这种方式同<a class="link" href="https://refactoringguru.cn/design-patterns/decorator"  target="_blank" rel="noopener"
    >装饰</a>模式非常相似。</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Target</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#f92672">~</span>Target() <span style="color:#f92672">=</span> <span style="color:#66d9ef">default</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> std<span style="color:#f92672">::</span>string Request() <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Target: The default target&#39;s behavior.&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The Adaptee contains some useful behavior, but its interface is incompatible
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * with the existing client code. The Adaptee needs some adaptation before the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * client code can use it.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Adaptee</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string SpecificRequest() <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;.eetpadA eht fo roivaheb laicepS&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The Adapter makes the Adaptee&#39;s interface compatible with the Target&#39;s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * interface.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Adapter</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Target {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  	Adaptee <span style="color:#f92672">*</span>adaptee_;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    Adapter(Adaptee <span style="color:#f92672">*</span>adaptee) <span style="color:#f92672">:</span> adaptee_(adaptee) {}
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string Request() <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>string to_reverse <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>adaptee_<span style="color:#f92672">-&gt;</span>SpecificRequest();
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>reverse(to_reverse.begin(), to_reverse.end());
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Adapter: (TRANSLATED) &#34;</span> <span style="color:#f92672">+</span> to_reverse;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The client code supports all classes that follow the Target interface.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ClientCode</span>(<span style="color:#66d9ef">const</span> Target <span style="color:#f92672">*</span>target) {
</span></span><span style="display:flex;"><span>  	std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> target<span style="color:#f92672">-&gt;</span>Request();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Client: I can work just fine with the Target objects:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    Target <span style="color:#f92672">*</span>target <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Target;
</span></span><span style="display:flex;"><span>    ClientCode(target);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    Adaptee <span style="color:#f92672">*</span>adaptee <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Adaptee;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Client: The Adaptee class has a weird interface. See, I don&#39;t understand it:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Adaptee: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> adaptee<span style="color:#f92672">-&gt;</span>SpecificRequest();
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Client: But I can work with it via the Adapter:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    Adapter <span style="color:#f92672">*</span>adapter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Adapter(adaptee);
</span></span><span style="display:flex;"><span>    ClientCode(adapter);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> target;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> adaptee;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> adapter;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="桥接模式">桥接模式</h1>
<p><strong>桥接模式</strong>是一种结构型设计模式， 可将一个大类或一系列紧密相关的类拆分为抽象和实现两个独立的层次结构， 从而能在开发时分别使用。</p>
<p>适用场景：</p>
<ul>
<li>
<p><strong>如果你想要拆分或重组一个具有多重功能的庞杂类 （例如能与多个数据库服务器进行交互的类）， 可以使用桥接模式。</strong></p>
</li>
<li>
<p>类的代码行数越多， 弄清其运作方式就越困难， 对其进行修改所花费的时间就越长。 一个功能上的变化可能需要在整个类范围内进行修改， 而且常常会产生错误， 甚至还会有一些严重的副作用。</p>
</li>
<li>
<p>桥接模式可以将庞杂类拆分为几个类层次结构。 此后， 你可以修改任意一个类层次结构而不会影响到其他类层次结构。 这种方法可以简化代码的维护工作， 并将修改已有代码的风险降到最低。</p>
</li>
<li>
<p><strong>如果你希望在几个独立维度上扩展一个类， 可使用该模式。</strong></p>
</li>
<li>
<p>桥接建议将每个维度抽取为独立的类层次。 初始类将相关工作委派给属于对应类层次的对象， 无需自己完成所有工作。</p>
</li>
<li>
<p><strong>如果你需要在运行时切换不同实现方法， 可使用桥接模式。</strong></p>
</li>
<li>
<p>当然并不是说一定要实现这一点， 桥接模式可替换抽象部分中的实现对象， 具体操作就和给成员变量赋新值一样简单。</p>
</li>
<li>
<p>顺便提一句， 最后一点是很多人混淆桥接模式和<a class="link" href="https://refactoringguru.cn/design-patterns/strategy"  target="_blank" rel="noopener"
    >策略</a>模式的主要原因。 记住， 设计模式并不仅是一种对类进行组织的方式， 它还能用于沟通意图和解决问题。</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Implementation</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#f92672">~</span>Implementation() {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> std<span style="color:#f92672">::</span>string OperationImplementation() <span style="color:#66d9ef">const</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Each Concrete Implementation corresponds to a specific platform and
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * implements the Implementation interface using that platform&#39;s API.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConcreteImplementationA</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Implementation {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string OperationImplementation() <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;ConcreteImplementationA: Here&#39;s the result on the platform A.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConcreteImplementationB</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Implementation {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string OperationImplementation() <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;ConcreteImplementationB: Here&#39;s the result on the platform B.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The Abstraction defines the interface for the &#34;control&#34; part of the two class
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * hierarchies. It maintains a reference to an object of the Implementation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * hierarchy and delegates all of the real work to this object.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Abstraction</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @var Implementation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">protected</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  	Implementation<span style="color:#f92672">*</span> implementation_;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    Abstraction(Implementation<span style="color:#f92672">*</span> implementation) <span style="color:#f92672">:</span> implementation_(implementation) {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#f92672">~</span>Abstraction() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> std<span style="color:#f92672">::</span>string Operation() <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Abstraction: Base operation with:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>implementation_<span style="color:#f92672">-&gt;</span>OperationImplementation();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * You can extend the Abstraction without changing the Implementation classes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExtendedAbstraction</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Abstraction {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    ExtendedAbstraction(Implementation<span style="color:#f92672">*</span> implementation) <span style="color:#f92672">:</span> Abstraction(implementation) {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string Operation() <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;ExtendedAbstraction: Extended operation with:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>implementation_<span style="color:#f92672">-&gt;</span>OperationImplementation();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Except for the initialization phase, where an Abstraction object gets linked
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * with a specific Implementation object, the client code should only depend on
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * the Abstraction class. This way the client code can support any abstraction-
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * implementation combination.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ClientCode</span>(<span style="color:#66d9ef">const</span> Abstraction<span style="color:#f92672">&amp;</span> abstraction) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> abstraction.Operation();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The client code should be able to work with any pre-configured abstraction-
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * implementation combination.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    Implementation<span style="color:#f92672">*</span> implementation <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConcreteImplementationA;
</span></span><span style="display:flex;"><span>    Abstraction<span style="color:#f92672">*</span> abstraction <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Abstraction(implementation);
</span></span><span style="display:flex;"><span>    ClientCode(<span style="color:#f92672">*</span>abstraction);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> implementation;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> abstraction;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    implementation <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConcreteImplementationB;
</span></span><span style="display:flex;"><span>    abstraction <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ExtendedAbstraction(implementation);
</span></span><span style="display:flex;"><span>    ClientCode(<span style="color:#f92672">*</span>abstraction);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> implementation;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> abstraction;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="组合模式">组合模式</h1>
<p><strong>组合模式</strong>是一种结构型设计模式， 你可以使用它将对象组合成树状结构， 并且能像使用独立对象一样使用它们。</p>
<p><strong>适用场景</strong></p>
<ul>
<li>
<p>如果你需要实现树状对象结构， 可以使用组合模式。</p>
</li>
<li>
<p>组合模式为你提供了两种共享公共接口的基本元素类型： 简单叶节点和复杂容器。 容器中可以包含叶节点和其他容器。 这使得你可以构建树状嵌套递归对象结构。</p>
</li>
<li>
<p>如果你希望客户端代码以相同方式处理简单和复杂元素， 可以使用该模式。</p>
</li>
<li>
<p>组合模式中定义的所有元素共用同一个接口。 在这一接口的帮助下， 客户端不必在意其所使用的对象的具体类。</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;algorithm&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;list&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The base Component class declares common operations for both simple and
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * complex objects of a composition.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Component</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * @var Component
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">protected</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  	Component <span style="color:#f92672">*</span>parent_;
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * Optionally, the base Component can declare an interface for setting and
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * accessing a parent of the component in a tree structure. It can also
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * provide some default implementation for these methods.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#f92672">~</span>Component() {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">SetParent</span>(Component <span style="color:#f92672">*</span>parent) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>parent_ <span style="color:#f92672">=</span> parent;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    Component <span style="color:#f92672">*</span><span style="color:#a6e22e">GetParent</span>() <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>parent_;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * In some cases, it would be beneficial to define the child-management
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * operations right in the base Component class. This way, you won&#39;t need to
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * expose any concrete component classes to the client code, even during the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * object tree assembly. The downside is that these methods will be empty for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * the leaf-level components.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Add</span>(Component <span style="color:#f92672">*</span>component) {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Remove</span>(Component <span style="color:#f92672">*</span>component) {}
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * You can provide a method that lets the client code figure out whether a
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * component can bear children.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">IsComposite</span>() <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> false;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * The base Component may implement some default behavior or leave it to
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * concrete classes (by declaring the method containing the behavior as
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * &#34;abstract&#34;).
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span>  	<span style="color:#66d9ef">virtual</span> std<span style="color:#f92672">::</span>string Operation() <span style="color:#66d9ef">const</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * The Leaf class represents the end objects of a composition. A leaf can&#39;t have
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * any children.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Usually, it&#39;s the Leaf objects that do the actual work, whereas Composite
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * objects only delegate to their sub-components.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Leaf</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Component {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string Operation() <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Leaf&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The Composite class represents the complex components that may have children.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Usually, the Composite objects delegate the actual work to their children and
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * then &#34;sum-up&#34; the result.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Composite</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Component {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @var \SplObjectStorage
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">protected</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  	std<span style="color:#f92672">::</span>list<span style="color:#f92672">&lt;</span>Component <span style="color:#f92672">*&gt;</span> children_;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * A composite object can add or remove other components (both simple or
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * complex) to or from its child list.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> Add(Component <span style="color:#f92672">*</span>component) <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>children_.push_back(component);
</span></span><span style="display:flex;"><span>        component<span style="color:#f92672">-&gt;</span>SetParent(<span style="color:#66d9ef">this</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Have in mind that this method removes the pointer to the list but doesn&#39;t
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * frees the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *     memory, you should do it manually or better use smart pointers.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Remove</span>(Component <span style="color:#f92672">*</span>component) <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        children_.remove(component);
</span></span><span style="display:flex;"><span>        component<span style="color:#f92672">-&gt;</span>SetParent(<span style="color:#66d9ef">nullptr</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">IsComposite</span>() <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> true;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * The Composite executes its primary logic in a particular way. It traverses
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * recursively through all its children, collecting and summing their results.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Since the composite&#39;s children pass these calls to their children and so
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * forth, the whole object tree is traversed as a result.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string Operation() <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>string result;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> Component <span style="color:#f92672">*</span>c : children_) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (c <span style="color:#f92672">==</span> children_.back()) {
</span></span><span style="display:flex;"><span>                result <span style="color:#f92672">+=</span> c<span style="color:#f92672">-&gt;</span>Operation();
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                result <span style="color:#f92672">+=</span> c<span style="color:#f92672">-&gt;</span>Operation() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;+&#34;</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Branch(&#34;</span> <span style="color:#f92672">+</span> result <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The client code works with all of the components via the base interface.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ClientCode</span>(Component <span style="color:#f92672">*</span>component) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;RESULT: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> component<span style="color:#f92672">-&gt;</span>Operation();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Thanks to the fact that the child-management operations are declared in the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * base Component class, the client code can work with any component, simple or
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * complex, without depending on their concrete classes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ClientCode2</span>(Component <span style="color:#f92672">*</span>component1, Component <span style="color:#f92672">*</span>component2) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (component1<span style="color:#f92672">-&gt;</span>IsComposite()) {
</span></span><span style="display:flex;"><span>        component1<span style="color:#f92672">-&gt;</span>Add(component2);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;RESULT: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> component1<span style="color:#f92672">-&gt;</span>Operation();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * This way the client code can support the simple leaf components...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    Component <span style="color:#f92672">*</span>simple <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Leaf;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Client: I&#39;ve got a simple component:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    ClientCode(simple);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * ...as well as the complex composites.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Component <span style="color:#f92672">*</span>tree <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Composite;
</span></span><span style="display:flex;"><span>    Component <span style="color:#f92672">*</span>branch1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Composite;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Component <span style="color:#f92672">*</span>leaf_1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Leaf;
</span></span><span style="display:flex;"><span>    Component <span style="color:#f92672">*</span>leaf_2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Leaf;
</span></span><span style="display:flex;"><span>    Component <span style="color:#f92672">*</span>leaf_3 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Leaf;
</span></span><span style="display:flex;"><span>    branch1<span style="color:#f92672">-&gt;</span>Add(leaf_1);
</span></span><span style="display:flex;"><span>    branch1<span style="color:#f92672">-&gt;</span>Add(leaf_2);
</span></span><span style="display:flex;"><span>    Component <span style="color:#f92672">*</span>branch2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Composite;
</span></span><span style="display:flex;"><span>    branch2<span style="color:#f92672">-&gt;</span>Add(leaf_3);
</span></span><span style="display:flex;"><span>    tree<span style="color:#f92672">-&gt;</span>Add(branch1);
</span></span><span style="display:flex;"><span>    tree<span style="color:#f92672">-&gt;</span>Add(branch2);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Client: Now I&#39;ve got a composite tree:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    ClientCode(tree);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Client: I don&#39;t need to check the components classes even when managing the tree:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    ClientCode2(tree, simple);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> simple;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> tree;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> branch1;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> branch2;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> leaf_1;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> leaf_2;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> leaf_3;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="装饰模式">装饰模式</h1>
<p><strong>装饰模式</strong>是一种结构型设计模式， 允许你通过将对象放入包含行为的特殊封装对象中来为原对象绑定新的行为。</p>
<p>适用场景：</p>
<ul>
<li>
<p>如果你希望在无需修改代码的情况下即可使用对象， 且希望在运行时为对象新增额外的行为， 可以使用装饰模式。</p>
</li>
<li>
<p>装饰能将业务逻辑组织为层次结构， 你可为各层创建一个装饰， 在运行时将各种不同逻辑组合成对象。 由于这些对象都遵循通用接口， 客户端代码能以相同的方式使用这些对象。</p>
</li>
<li>
<p>如果用继承来扩展对象行为的方案难以实现或者根本不可行， 你可以使用该模式。</p>
</li>
<li>
<p>许多编程语言使用 <code>final</code> <code>最终</code>关键字来限制对某个类的进一步扩展。 复用最终类已有行为的唯一方法是使用装饰模式： 用封装器对其进行封装。</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The base Component interface defines operations that can be altered by
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * decorators.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Component</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#f92672">~</span>Component() {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> std<span style="color:#f92672">::</span>string Operation() <span style="color:#66d9ef">const</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Concrete Components provide default implementations of the operations. There
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * might be several variations of these classes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConcreteComponent</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Component {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string Operation() <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;ConcreteComponent&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The base Decorator class follows the same interface as the other components.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The primary purpose of this class is to define the wrapping interface for all
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * concrete decorators. The default implementation of the wrapping code might
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * include a field for storing a wrapped component and the means to initialize
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * it.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Decorator</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Component {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @var Component
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">protected</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  	Component<span style="color:#f92672">*</span> component_;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    Decorator(Component<span style="color:#f92672">*</span> component) <span style="color:#f92672">:</span> component_(component) {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * The Decorator delegates all work to the wrapped component.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string Operation() <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>component_<span style="color:#f92672">-&gt;</span>Operation();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Concrete Decorators call the wrapped object and alter its result in some way.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConcreteDecoratorA</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Decorator {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Decorators may call parent implementation of the operation, instead of
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * calling the wrapped object directly. This approach simplifies extension of
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * decorator classes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    ConcreteDecoratorA(Component<span style="color:#f92672">*</span> component) <span style="color:#f92672">:</span> Decorator(component) {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string Operation() <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;ConcreteDecoratorA(&#34;</span> <span style="color:#f92672">+</span> Decorator<span style="color:#f92672">::</span>Operation() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Decorators can execute their behavior either before or after the call to a
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * wrapped object.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConcreteDecoratorB</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Decorator {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    ConcreteDecoratorB(Component<span style="color:#f92672">*</span> component) <span style="color:#f92672">:</span> Decorator(component) {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string Operation() <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;ConcreteDecoratorB(&#34;</span> <span style="color:#f92672">+</span> Decorator<span style="color:#f92672">::</span>Operation() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The client code works with all objects using the Component interface. This
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * way it can stay independent of the concrete classes of components it works
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * with.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ClientCode</span>(Component<span style="color:#f92672">*</span> component) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;RESULT: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> component<span style="color:#f92672">-&gt;</span>Operation();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * This way the client code can support both simple components...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span>    Component<span style="color:#f92672">*</span> simple <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConcreteComponent;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Client: I&#39;ve got a simple component:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    ClientCode(simple);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * ...as well as decorated ones.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * Note how decorators can wrap not only simple components but the other
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * decorators as well.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span>    Component<span style="color:#f92672">*</span> decorator1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConcreteDecoratorA(simple);
</span></span><span style="display:flex;"><span>    Component<span style="color:#f92672">*</span> decorator2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConcreteDecoratorB(decorator1);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Client: Now I&#39;ve got a decorated component:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    ClientCode(decorator2);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> simple;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> decorator1;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> decorator2;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="外观模式">外观模式</h1>
<p><strong>外观模式</strong>是一种结构型设计模式， 能为程序库、 框架或其他复杂类提供一个简单的接口。</p>
<p>适用场景:</p>
<ul>
<li>
<p><strong>如果你需要一个指向复杂子系统的直接接口， 且该接口的功能有限， 则可以使用外观模式。</strong></p>
</li>
<li>
<p>子系统通常会随着时间的推进变得越来越复杂。 即便是应用了设计模式， 通常你也会创建更多的类。 尽管在多种情形中子系统可能是更灵活或易于复用的， 但其所需的配置和样板代码数量将会增长得更快。 为了解决这个问题， 外观将会提供指向子系统中最常用功能的快捷方式， 能够满足客户端的大部分需求。</p>
</li>
<li>
<p><strong>如果需要将子系统组织为多层结构， 可以使用外观。</strong></p>
</li>
<li>
<p>创建外观来定义子系统中各层次的入口。 你可以要求子系统仅使用外观来进行交互， 以减少子系统之间的耦合。</p>
</li>
<li>
<p>让我们回到视频转换框架的例子。 该框架可以拆分为两个层次： 音频相关和视频相关。 你可以为每个层次创建一个外观， 然后要求各层的类必须通过这些外观进行交互。 这种方式看上去与<a class="link" href="https://refactoringguru.cn/design-patterns/mediator"  target="_blank" rel="noopener"
    >中介者</a>模式非常相似。</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The Subsystem can accept requests either from the facade or client directly.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * In any case, to the Subsystem, the Facade is yet another client, and it&#39;s not
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * a part of the Subsystem.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Subsystem1</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string Operation1() <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Subsystem1: Ready!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>string OperationN() <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Subsystem1: Go!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Some facades can work with multiple subsystems at the same time.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Subsystem2</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string Operation1() <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Subsystem2: Get ready!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>string OperationZ() <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Subsystem2: Fire!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The Facade class provides a simple interface to the complex logic of one or
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * several subsystems. The Facade delegates the client requests to the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * appropriate objects within the subsystem. The Facade is also responsible for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * managing their lifecycle. All of this shields the client from the undesired
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * complexity of the subsystem.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Facade</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">protected</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    Subsystem1 <span style="color:#f92672">*</span>subsystem1_;
</span></span><span style="display:flex;"><span>    Subsystem2 <span style="color:#f92672">*</span>subsystem2_;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Depending on your application&#39;s needs, you can provide the Facade with
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * existing subsystem objects or force the Facade to create them on its own.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * In this case we will delegate the memory ownership to Facade Class
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span>    Facade(
</span></span><span style="display:flex;"><span>        Subsystem1 <span style="color:#f92672">*</span>subsystem1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>,
</span></span><span style="display:flex;"><span>        Subsystem2 <span style="color:#f92672">*</span>subsystem2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>subsystem1_ <span style="color:#f92672">=</span> subsystem1 <span style="color:#f92672">?:</span> <span style="color:#66d9ef">new</span> Subsystem1;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>subsystem2_ <span style="color:#f92672">=</span> subsystem2 <span style="color:#f92672">?:</span> <span style="color:#66d9ef">new</span> Subsystem2;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">~</span>Facade() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">delete</span> subsystem1_;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">delete</span> subsystem2_;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * The Facade&#39;s methods are convenient shortcuts to the sophisticated
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * functionality of the subsystems. However, clients get only to a fraction of
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * a subsystem&#39;s capabilities.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string Operation() {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>string result <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Facade initializes subsystems:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">+=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>subsystem1_<span style="color:#f92672">-&gt;</span>Operation1();
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">+=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>subsystem2_<span style="color:#f92672">-&gt;</span>Operation1();
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;Facade orders subsystems to perform the action:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">+=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>subsystem1_<span style="color:#f92672">-&gt;</span>OperationN();
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">+=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>subsystem2_<span style="color:#f92672">-&gt;</span>OperationZ();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The client code works with complex subsystems through a simple interface
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * provided by the Facade. When a facade manages the lifecycle of the subsystem,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * the client might not even know about the existence of the subsystem. This
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * approach lets you keep the complexity under control.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ClientCode</span>(Facade <span style="color:#f92672">*</span>facade) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> facade<span style="color:#f92672">-&gt;</span>Operation();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The client code may have some of the subsystem&#39;s objects already created. In
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * this case, it might be worthwhile to initialize the Facade with these objects
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * instead of letting the Facade create new instances.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    Subsystem1 <span style="color:#f92672">*</span>subsystem1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Subsystem1;
</span></span><span style="display:flex;"><span>    Subsystem2 <span style="color:#f92672">*</span>subsystem2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Subsystem2;
</span></span><span style="display:flex;"><span>    Facade <span style="color:#f92672">*</span>facade <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Facade(subsystem1, subsystem2);
</span></span><span style="display:flex;"><span>    ClientCode(facade);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> facade;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="享元模式">享元模式</h1>
<p><strong>享元模式</strong>是一种结构型设计模式， 它摒弃了在每个对象中保存所有数据的方式， 通过共享多个对象所共有的相同状态， 让你能在有限的内存容量中载入更多对象。</p>
<p>适用场景:</p>
<ul>
<li>
<p><strong>仅在程序必须支持大量对象且没有足够的内存容量时使用享元模式。</strong></p>
</li>
<li>
<p>应用该模式所获的收益大小取决于使用它的方式和情景。 它在下列情况中最有效：</p>
<ul>
<li>程序需要生成数量巨大的相似对象</li>
<li>这将耗尽目标设备的所有内存</li>
<li>对象中包含可抽取且能在多个对象间共享的重复状态。</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Flyweight Design Pattern
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Intent: Lets you fit more objects into the available amount of RAM by sharing
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * common parts of state between multiple objects, instead of keeping all of the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * data in each object.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">SharedState</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string brand_;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string model_;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string color_;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    SharedState(<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string <span style="color:#f92672">&amp;</span>brand, <span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string <span style="color:#f92672">&amp;</span>model, <span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string <span style="color:#f92672">&amp;</span>color)
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:</span> brand_(brand), model_(model), color_(color)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">friend</span> std<span style="color:#f92672">::</span>ostream <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">&lt;&lt;</span>(std<span style="color:#f92672">::</span>ostream <span style="color:#f92672">&amp;</span>os, <span style="color:#66d9ef">const</span> SharedState <span style="color:#f92672">&amp;</span>ss)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> os <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;[ &#34;</span> <span style="color:#f92672">&lt;&lt;</span> ss.brand_ <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; , &#34;</span> <span style="color:#f92672">&lt;&lt;</span> ss.model_ <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; , &#34;</span> <span style="color:#f92672">&lt;&lt;</span> ss.color_ <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; ]&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">UniqueState</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string owner_;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string plates_;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UniqueState(<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string <span style="color:#f92672">&amp;</span>owner, <span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string <span style="color:#f92672">&amp;</span>plates)
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:</span> owner_(owner), plates_(plates)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">friend</span> std<span style="color:#f92672">::</span>ostream <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">&lt;&lt;</span>(std<span style="color:#f92672">::</span>ostream <span style="color:#f92672">&amp;</span>os, <span style="color:#66d9ef">const</span> UniqueState <span style="color:#f92672">&amp;</span>us)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> os <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;[ &#34;</span> <span style="color:#f92672">&lt;&lt;</span> us.owner_ <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; , &#34;</span> <span style="color:#f92672">&lt;&lt;</span> us.plates_ <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; ]&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The Flyweight stores a common portion of the state (also called intrinsic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * state) that belongs to multiple real business entities. The Flyweight accepts
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * the rest of the state (extrinsic state, unique for each entity) via its
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * method parameters.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Flyweight</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    SharedState <span style="color:#f92672">*</span>shared_state_;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    Flyweight(<span style="color:#66d9ef">const</span> SharedState <span style="color:#f92672">*</span>shared_state) <span style="color:#f92672">:</span> shared_state_(<span style="color:#66d9ef">new</span> SharedState(<span style="color:#f92672">*</span>shared_state))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    Flyweight(<span style="color:#66d9ef">const</span> Flyweight <span style="color:#f92672">&amp;</span>other) <span style="color:#f92672">:</span> shared_state_(<span style="color:#66d9ef">new</span> SharedState(<span style="color:#f92672">*</span>other.shared_state_))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">~</span>Flyweight()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">delete</span> shared_state_;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    SharedState <span style="color:#f92672">*</span><span style="color:#a6e22e">shared_state</span>() <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> shared_state_;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Operation</span>(<span style="color:#66d9ef">const</span> UniqueState <span style="color:#f92672">&amp;</span>unique_state) <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Flyweight: Displaying shared (&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#f92672">*</span>shared_state_ <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;) and unique (&#34;</span> <span style="color:#f92672">&lt;&lt;</span> unique_state <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;) state.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The Flyweight Factory creates and manages the Flyweight objects. It ensures
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * that flyweights are shared correctly. When the client requests a flyweight,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * the factory either returns an existing instance or creates a new one, if it
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * doesn&#39;t exist yet.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FlyweightFactory</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @var Flyweight[]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>unordered_map<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>string, Flyweight<span style="color:#f92672">&gt;</span> flyweights_;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Returns a Flyweight&#39;s string hash for a given state.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string GetKey(<span style="color:#66d9ef">const</span> SharedState <span style="color:#f92672">&amp;</span>ss) <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ss.brand_ <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> ss.model_ <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> ss.color_;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    FlyweightFactory(std<span style="color:#f92672">::</span>initializer_list<span style="color:#f92672">&lt;</span>SharedState<span style="color:#f92672">&gt;</span> share_states)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> SharedState <span style="color:#f92672">&amp;</span>ss : share_states)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>flyweights_.insert(std<span style="color:#f92672">::</span>make_pair<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>string, Flyweight<span style="color:#f92672">&gt;</span>(<span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>GetKey(ss), Flyweight(<span style="color:#f92672">&amp;</span>ss)));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Returns an existing Flyweight with a given state or creates a new one.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    Flyweight <span style="color:#a6e22e">GetFlyweight</span>(<span style="color:#66d9ef">const</span> SharedState <span style="color:#f92672">&amp;</span>shared_state)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>string key <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>GetKey(shared_state);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>flyweights_.find(key) <span style="color:#f92672">==</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>flyweights_.end())
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;FlyweightFactory: Can&#39;t find a flyweight, creating new one.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>flyweights_.insert(std<span style="color:#f92672">::</span>make_pair(key, Flyweight(<span style="color:#f92672">&amp;</span>shared_state)));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;FlyweightFactory: Reusing existing flyweight.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>flyweights_.at(key);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ListFlyweights</span>() <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        size_t count <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>flyweights_.size();
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">FlyweightFactory: I have &#34;</span> <span style="color:#f92672">&lt;&lt;</span> count <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; flyweights:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>string, Flyweight<span style="color:#f92672">&gt;</span> pair : <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>flyweights_)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> pair.first <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">AddCarToPoliceDatabase</span>(
</span></span><span style="display:flex;"><span>    FlyweightFactory <span style="color:#f92672">&amp;</span>ff, <span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string <span style="color:#f92672">&amp;</span>plates, <span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string <span style="color:#f92672">&amp;</span>owner,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string <span style="color:#f92672">&amp;</span>brand, <span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string <span style="color:#f92672">&amp;</span>model, <span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string <span style="color:#f92672">&amp;</span>color)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Client: Adding a car to database.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> Flyweight <span style="color:#f92672">&amp;</span>flyweight <span style="color:#f92672">=</span> ff.GetFlyweight({brand, model, color});
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// The client code either stores or calculates extrinsic state and passes it
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// to the flyweight&#39;s methods.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    flyweight.Operation({owner, plates});
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The client code usually creates a bunch of pre-populated flyweights in the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * initialization stage of the application.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    FlyweightFactory <span style="color:#f92672">*</span>factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FlyweightFactory({{<span style="color:#e6db74">&#34;Chevrolet&#34;</span>, <span style="color:#e6db74">&#34;Camaro2018&#34;</span>, <span style="color:#e6db74">&#34;pink&#34;</span>}, {<span style="color:#e6db74">&#34;Mercedes Benz&#34;</span>, <span style="color:#e6db74">&#34;C300&#34;</span>, <span style="color:#e6db74">&#34;black&#34;</span>}, {<span style="color:#e6db74">&#34;Mercedes Benz&#34;</span>, <span style="color:#e6db74">&#34;C500&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>}, {<span style="color:#e6db74">&#34;BMW&#34;</span>, <span style="color:#e6db74">&#34;M5&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>}, {<span style="color:#e6db74">&#34;BMW&#34;</span>, <span style="color:#e6db74">&#34;X6&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>}});
</span></span><span style="display:flex;"><span>    factory<span style="color:#f92672">-&gt;</span>ListFlyweights();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    AddCarToPoliceDatabase(<span style="color:#f92672">*</span>factory,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;CL234IR&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;James Doe&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;BMW&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;M5&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;red&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    AddCarToPoliceDatabase(<span style="color:#f92672">*</span>factory,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;CL234IR&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;James Doe&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;BMW&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;X1&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;red&#34;</span>);
</span></span><span style="display:flex;"><span>    factory<span style="color:#f92672">-&gt;</span>ListFlyweights();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> factory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
        
    </section>


    </footer>


    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="">
    <a href="/post/c-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/">
        
        

        <div class="article-details">
            <h2 class="article-title">C&#43;&#43;设计模式-创建型模式</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
    
        
    <div id="cusdis_thread"
    data-host="https://cusdis.com"
    data-app-id="d44db3f9-a0ff-4551-a44d-316afd2e5835"
    data-page-id="e7d44a5a9140873a03856b313975215c"
    data-page-url="https://okokfun.github.io/post/c-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/"
    data-page-title="C&#43;&#43;设计模式-结构型模式"></div>
<script async defer src="https://cusdis.com/js/cusdis.es.js"></script>

<script>
    function setCusdisTheme(theme) {
        let cusdis = document.querySelector('#cusdis_thread iframe');
        if (cusdis) {
            window.CUSDIS.setTheme(theme)
        }
    }

    window.addEventListener('onColorSchemeChange', (e) => {
        setCusdisTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2023 My Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.5.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
